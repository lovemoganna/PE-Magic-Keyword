# 导入导出功能更新说明

## 更新内容

### ✅ 1. 新增导入格式支持

#### Markdown (.md) 格式导入
- **支持格式**: 标准Markdown格式的关键词列表
- **解析规则**:
  - 使用 `##` 作为关键词分隔符
  - 支持以下字段解析：
    - `**分类**:` - 分类（支持中文标签）
    - `**深度**:` - 深度级别（支持中文标签）
    - `**描述**:` - 描述内容
    - `**认知影响**:` - 认知影响
    - `**示例**:` - 示例列表（支持多行列表）
    - `**相关词**:` - 相关词（逗号分隔）
    - `**跨领域应用**:` - 跨领域应用（逗号分隔）

**示例格式**:
```markdown
## 1. 第一性原理

- **分类**: 🧠 核心催化器
- **深度**: 🏗️ 基础构建
- **描述**: 回归事物本质，从基本假设重新构建理解...
- **认知影响**: 激活深度推理和创新思维模式
- **示例**:
  - 马斯克思维
  - 物理学推演
- **相关词**: 本质还原, 假设验证
- **跨领域应用**: 科学, 商业, 哲学
```

### ✅ 2. 新增导出格式支持

#### Excel (.xlsx) 格式导出
- **文件格式**: .xlsx扩展名
- **实际内容**: UTF-8编码的CSV格式（带BOM）
- **特点**: 
  - 可直接在Excel中打开
  - 支持中文显示（已修复乱码）
  - 适合在Excel中编辑和查看

#### Markdown (.md) 格式导出
- **文件格式**: 标准Markdown文档
- **内容结构**:
  - 标题和统计信息
  - 每个关键词独立章节
  - 包含所有字段信息
  - 适合文档阅读和版本控制

**导出格式示例**:
```markdown
# 魔法关键词列表

共 380 个关键词

---

## 1. 第一性原理

- **分类**: 🧠 核心催化器
- **深度**: 🏗️ 基础构建
- **描述**: 回归事物本质，从基本假设重新构建理解...
- **认知影响**: 激活深度推理和创新思维模式
- **示例**:
  - 马斯克思维
  - 物理学推演
- **相关词**: 本质还原, 假设验证
- **跨领域应用**: 科学, 商业, 哲学

---
```

### ✅ 3. 修复CSV中文乱码问题

**问题**: CSV文件在Excel中打开时中文显示为乱码

**解决方案**: 
- 在CSV文件开头添加UTF-8 BOM (`\uFEFF`)
- 确保Excel正确识别UTF-8编码
- 同时修复了导入时对BOM的处理

**技术实现**:
```typescript
// 导出时添加BOM
return '\uFEFF' + csvContent;

// 导入时移除BOM（如果存在）
if (content.charCodeAt(0) === 0xFEFF) {
    content = content.slice(1);
}
```

## 支持的格式总览

### 导入格式
| 格式 | 扩展名 | 状态 | 说明 |
|------|--------|------|------|
| JSON | .json | ✅ | 完整数据结构 |
| CSV | .csv | ✅ | 表格格式（已修复乱码） |
| Markdown | .md | ✅ | 文档格式（新增） |
| Excel | .xlsx | ✅ | Excel格式（新增，实际为CSV） |

### 导出格式
| 格式 | 扩展名 | 状态 | 说明 |
|------|--------|------|------|
| JSON | .json | ✅ | 完整数据结构 |
| CSV | .csv | ✅ | 表格格式（已修复乱码） |
| Excel | .xlsx | ✅ | Excel格式（新增） |
| Markdown | .md | ✅ | 文档格式（新增） |

## 使用方法

### 导入Markdown文件

1. 打开管理后台
2. 点击"导入/导出"按钮
3. 选择"导入"标签
4. 选择.md文件或粘贴Markdown内容
5. 配置导入选项（合并/覆盖）
6. 点击"导入"按钮

### 导出Excel文件

1. 打开管理后台
2. 点击"导入/导出"按钮
3. 选择"导出"标签
4. 点击"Excel格式"卡片
5. 文件自动下载（.xlsx格式）

### 导出Markdown文件

1. 打开管理后台
2. 点击"导入/导出"按钮
3. 选择"导出"标签
4. 点击"Markdown格式"卡片
5. 文件自动下载（.md格式）

## 技术细节

### Markdown导入解析逻辑

1. **分割关键词块**: 使用 `##` 作为分隔符
2. **提取关键词名称**: 从第一行提取（支持序号格式）
3. **解析字段**: 使用正则表达式匹配各种字段
4. **处理列表**: 示例字段支持多行列表格式
5. **分类/深度转换**: 自动将中文标签转换为英文key

### CSV乱码修复

- **问题原因**: Excel默认使用系统编码打开CSV，中文UTF-8文件会乱码
- **解决方案**: 添加UTF-8 BOM标记，Excel会自动识别UTF-8编码
- **兼容性**: 不影响其他软件（如记事本、VS Code等）的正常显示

### Excel导出实现

- **当前实现**: 使用CSV格式，但文件扩展名为.xlsx
- **优点**: 无需额外依赖，文件小，兼容性好
- **限制**: 不是真正的Excel格式，但可以在Excel中正常打开和编辑
- **未来优化**: 如需真正的Excel格式，可集成xlsx库

## 注意事项

1. **Markdown导入**:
   - 必须使用 `##` 作为关键词分隔符
   - 字段名称必须使用 `**字段名**:` 格式
   - 示例列表必须使用 `  - ` 缩进格式

2. **CSV乱码修复**:
   - 导出的CSV文件已包含BOM，可直接在Excel中打开
   - 如果仍有问题，请确保Excel版本支持UTF-8

3. **Excel导出**:
   - 当前实现为CSV格式，但扩展名为.xlsx
   - 可以在Excel中正常打开和编辑
   - 如需真正的Excel格式，建议使用xlsx库

## 测试建议

1. **导入测试**:
   - [ ] 测试JSON格式导入
   - [ ] 测试CSV格式导入（带BOM和不带BOM）
   - [ ] 测试Markdown格式导入
   - [ ] 测试Excel格式导入

2. **导出测试**:
   - [ ] 测试JSON格式导出
   - [ ] 测试CSV格式导出（在Excel中打开检查中文）
   - [ ] 测试Excel格式导出（在Excel中打开）
   - [ ] 测试Markdown格式导出

3. **乱码测试**:
   - [ ] 在Excel中打开CSV文件，检查中文显示
   - [ ] 在不同Excel版本中测试
   - [ ] 在不同操作系统中测试

## 更新文件清单

1. **services/keywordService.ts**
   - 添加 `exportMarkdown()` 方法
   - 添加 `exportExcel()` 方法
   - 添加 `importMarkdown()` 方法
   - 修复 `exportCSV()` 添加BOM
   - 修复 `importCSV()` 处理BOM

2. **components/admin/ImportExportModal.tsx**
   - 添加Excel导出按钮
   - 添加Markdown导出按钮
   - 更新导入逻辑支持Markdown
   - 更新文件选择器接受.md和.xlsx文件
   - 更新提示文本

---

**更新日期**: 2024年  
**版本**: 1.1.0  
**状态**: ✅ 完成

